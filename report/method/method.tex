\section{Method}
\subsection{Methodology and approach}
  \subsubsection{Alternatives}
  We found several alternatives for acquisition of memory from android devices.
  \begin{description}
    \item[dd on /dev/mem] \hfill \\
      This is a very simple method for acquiring memory. But /dev/mem can only be used directly when the kernel is 
      compiled with the STRICT\_DEVMEM flag off or with a kernel version pre 2.6. The first kernel version ever used on 
      android is version 2.6.25\footnote{http://elinux.org/Android\_Kernel\_Versions}. There is also a problem with 
      the dd application in android devices, it can not handle file offsets above 0x80000000 \cite{acq_vol_android_mem}.
    \item[fmem] \hfill \\
      fmem is a LKM (Loadable Kernel Module) which creates /dev/fmem. /dev/fmem is similar to /dev/mem, but without the limitations. 
      However, there are some issues using fmem on android devices running ARM including the problem with dd mentioned earlier \cite{acq_vol_android_mem}.
    \item[LiME LKM] \hfill \\
      LiME (Linux Memory Extractor) LKM\footnote{https://github.com/504ensicsLabs/LiME} provides a forensically sound method for acquiring memory from 
      memory \cite{heriyanto2013procedures}. LiME is formerly known as DMD (Droid Memory Dumpstr).
  \end{description}
  \subsubsection{Chosen approach}
  For acquisition of memory we have chosen to use the LiME LKM because of the problems described with the other methods.
\subsection{Environment}
When starting the project we needed to decide weather to use an physical device or an emulator
to conduct our experiment on.\\
To make the experiment as close to reality as possible it should have been done on a physical device, 
however, an emulator gives us a close match to reality and is easily replicable. Also, by using an emulator 
we avoid rooting our own phones, thus we avoid voiding warranty. Also, we found a guide on the Volatility 
wiki\footnote{https://github.com/volatilityfoundation/volatility/wiki/Android} for how to dump memory with 
an Android emulator. Therefore we chose to use an emulator.\\
Some deviation from the guide was done to be able conduct the experiment, due to the fact that we were running on 
a Linux system, not Mac OS X as the guide uses. This mostly involves editing the paths in the Makefiles you are editing 
to fit your system. % teit setning?
%A detailed guide on the setup can be found in the appendix \ref{setup}.\\

The emulator was set up on a computer running the latest Ubuntu (Ubuntu 14.04.1 LTS x86\_64).\\
The emulator we set up is based on the Nexus 7 (2012) with Android 4.2.2 Jelly Bean (API level 17) and The Linux Kernel 2.6.29. 
This was chosen because of convenience, since the guide we followed is using this and the 2.6 Kernel have very few restrictions.
\subsection{Tools}
What criteria we had for our tools
  \subsubsection{Volatility}
Volatility is a open source collection of tools used to extract digital
artefacts from memory.\footnote{https://github.com/volatilityfoundation/volatility} 
The framework is not meant for a live forensic analysis but an offline analysis
on memory acquired from a live machine or device, see Section \ref{lime} for
memory acquisition. Volatility has support for Windows, Mac OS, and Linux, and
from version 2.3 they also supported the ARM architecture, this is essential
for analysing memory on Android devices, as most devices that run Android has a
ARM architecture. With a memory dump Volatility can extract information such as
running processes, network connections, mounted devices and view the mapped
memory for processes and kernel modules. Volatility is especially useful when
analysing a system compromised by malware, as malware often hides itself in
memory to avoid detection. With Volatility the artefacts of the malware can be
found, and be analysed. \\

Volatility can also help when encryption is used on the device, if the device is
powered down the keys will be lost and you might be unable to use the data 
collected from a less volatile source such as a SD card or a hard drive. With
Volatility the keys can be extracted from the memory (if present), Volatility 
comes with a plugin that can be used to extract the key used by Truecrypt for 
disk encryption. In our case we wanted to see if we could find the encryption
key used by a popular SMS app to encrypt messages.\\

The easiest approach to the problem of finding data used by Android
applications is to go through the Dalvik VM as proposed by Case\cite{case2011}.
The Dalvik VM is the \textit{process virtual
machine}\footnote{https://en.wikipedia.org/wiki/Dalvik\_\%28software\%29} for
Android that is used to run Android application, applications are translated to
Dalvik bytecode. This makes the Dalvik VM a good entry point for analysing
applications. The first application that starts and runs in a Dalvik VM is the
\textit{zygote} process. It preloades and initializes classes that are shared
between different processes, it is also the process that will fork additional
Dalvik VMs if required. The Dalvik VM is implemented as a shared library which
is loaded dynamically by applications. This can be seen by the pstree and
proc\_maps plugins, see Appendix \ref{pstree} and \ref{procmaps}. \\

Since all the user applications on Android runs in a Dalvik VM it makes a good entry
point for forensic analysis, the source code is also publicly available. It is
written in C++, but makes use of simple C structures, which makes it easier to
locate them in memory compared to more complex structures such as classes. Case
and \cite{holger} shows that the \textit{DvmGlobals} structure which is
declared in \textit{dalvik/vm/Globals.h} contains a lot of information about
the application it is running. The \textit{loadedClasses} member is a pointer
to a hash table which contains the all the system classes, this makes it a
valuable structure because it can point us to where in memory information can
be found. 
%address space stuff here



  \subsubsection{PhotoRec}
  File recovery tool, supports many platforms and file systems, including memory images. 
  It Can extract images, text files and more.
  \subsubsection{Strings}
  Easy tool for getting all strings in a dump.
  \subsubsection{Hex editor}
  Useful for looking trough a dump.
\subsection{Experiments}
We did five dumps of the memory;
  \subsubsection{Clean dump}
  The first dump we did was right after boot, with factory settings and nothing done to the device 
  other than transferring the LiME LKM to the SD-card.
  \subsubsection{Pastebin entry}
  The second dump we did was after creating a pastebin entry on pastebin.com using the stock android browser (for 4.2.2),
  to see if we could find our entry in the memory.
  \subsubsection{Standard Text Message}
  The next dump was after sending a text message to the standard messages application. Since the emulator provides an telnet 
  interface, we where able to send a message using \texttt{sms send <phoneNumber> <textMessage>}.
  \subsubsection{Secure Text Message}
  Next we did the same as above, but after installing 
  TextSecure\footnote{https://play.google.com/store/apps/details?id=org.thoughtcrime.securesms}, which encrypts the messages. 
  \subsubsection{Screen lock}
  We also did a memory dump after creating a screen lock with a PIN code and using a passphrase.
